<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">

        <title>os-进程</title>

        <link rel="stylesheet" href="/css/stylesheet.css">


        <style type="text/css">
*{margin: 0; padding: 0;}
.clearfix:after {
    clear: both;
    content: ".";
    display: block;
    height: 0;
    visibility: hidden;
}
      .wrap {
           
          text-align: left;
      }
      .wrap span{
          display: inline-block;
          vertical-align: middle;
          word-break:break-word; 
          width: 50em;
      }
      .wrap img{
          width: 4.5em;
          height: auto;
          vertical-align: middle;
      }

      .wrap p{
          font-style:italic;
          font-size:12px;
      }

        </style>

    </head>
    <body>
        <section id="page-title">
            <h1>
                <a href="/">nber1994</a> </h1>
            <br>
            <div class="wrap">
                <script type="text/javascript">
                    

                    function chunkSubstr(str, size) {
                                            const numChunks = Math.ceil(str.length / size)
                                            const chunks = new Array(numChunks)

                                            for (let i = 0, o = 0; i < numChunks; ++i, o += size) {
                                                                    chunks[i] = str.substr(o, size)
                                                                }

                                            return chunks
                                        }
                    var pic = [];
                    pic[0] = "https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/qRKvRQ20220116152554.jpg";
                    pic[1] = "https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/nEf3GW20220116150946.jpg";
                    pic[2] = "https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/ITL6SB20220116154359.jpg";
                    pic[3] = "https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/3QAQ7M20220116154758.jpg";
                    pic[4] = "https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/HCCsx620220116160636.jpg";
                    pic[5] = "https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/c4zSPk20220116161109.jpg";
                    pic[6] = "https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/Bm5IHA20220116161518.jpg";
                    pic[7] = "https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/lpcstW20220116161917.jpg";
                    pic[8] = "https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/MSCA4K20220116162440.jpg";

                    var talk = [];
                    talk[0] = "Help poor children in Uganda!";
                    talk[1] = "Bad programmers worry about the code. Good programmers worry about data structures and their relationships.";
                    talk[2] = "So, dear Redis community, today I’m stepping back as the Redis maintainer.";
                    talk[3] = "Don't tune for speed until you've measured.";
                    talk[4] = "C is quirky, flawed, and an enormous success.";
                    talk[5] = "I've never thought of PHP as more than a simple tool to solve problems.";
                    talk[6] = "Java is C++ without the guns, clubs and knives.";
                    talk[7] = "Life is short, you need Python!";
                    talk[8] = "C makes it easy to shoot yourself in the foot; C++ makes it harder, but when you do it blows your whole leg off.";

                    var randomBgIndex = Math.floor( Math.random() * 8 );

                    
                    document.write("<img src=" + pic[randomBgIndex] + ">")
                    document.write("<span style='font-size:12px'>" + talk[randomBgIndex] + " </span>")
                    
                </script>
            </div>


        </section>
        <br>



<section class="blog-post">
    <h1>os-进程</h1>
    <div class="blog-post-subheader">
        August 9, 2019
    </div>
    <div class="blog-post-content">
        <h1 id="os-进程">os-进程</h1>
<h1 id="进程和线程之间的区别">进程和线程之间的区别：</h1>
<p><a href="http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html">进程之间的关系</a></p>
<h2 id="进程经典定义">进程经典定义</h2>
<p>一个执行中程序的实例</p>
<h2 id="进程上下文">进程上下文</h2>
<ul>
<li>同时进程运行依赖其进程运行时的上下文，上下文包括其
<ul>
<li>代码和数据</li>
<li>打开的文件描述符表</li>
<li>环境变量</li>
<li>运行时栈</li>
<li>通用目的寄存器
<img src="https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/20190517154006060_1623927614.png" alt=""></li>
</ul>
</li>
</ul>
<h2 id="进程提供的假象">进程提供的假象</h2>
<p>一个独立的逻辑控制流，好像是独占cpu
一个独立的地址空间，好像是独占主存</p>
<h2 id="并发流">并发流</h2>
<p>多任务也叫时间分片。每个进程执行它部分逻辑流的一段时间叫做时间分片</p>
<h2 id="私有地址空间">私有地址空间</h2>
<p><img src="https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/20190517154031478_981738775.png" alt="一个进程常见的内存情况"></p>
<h2 id="一个进程的常见内存情况">一个进程的常见内存情况</h2>
<ul>
<li>代码段总是从地址0x400000开始的，然后是数据段，然后是堆</li>
<li>内存最高位则是内核内存空间，用户栈是从2^48-1处开始向下延伸的</li>
<li>在用户栈和堆之间存在一块为共享库分配的内存空间</li>
</ul>
<h2 id="用户模式和内核模式">用户模式和内核模式</h2>
<ul>
<li>操作系统必须限制一个进程可以执行的指令和可以访问的内存空间，这种功能是通过控制某个模式位实现的</li>
<li>当设置了模式位时，进程就会运行在内核模式中</li>
<li>进程从用户态进入内核态的唯一方法是诸如中断，陷阱，故障这样的异常</li>
<li>当异常发生时，异常处理程序就会把模式位置为内核模式，当返回到用户程序时，处理器会将模式位置为用户位</li>
</ul>
<h2 id="调度">调度</h2>
<ul>
<li>内核决定抢占当前进程，并重新开始一个之前被抢占的进程，叫做调度</li>
<li>调度是通过切换进程运行的上下文来进行的
<ol>
<li>保存当前进程的上下文</li>
<li>恢复新进程的上下文环境</li>
<li>将控制权移交给新的进程</li>
</ol>
</li>
</ul>
<h3 id="调度的原因">调度的原因</h3>
<ul>
<li>阻塞：如果一个进程因为等待某个事件发生，如读取磁盘，内核可以让进程休眠，切换到另一个进程</li>
<li>中断：所有的机器都有产生周期性定时器中断的机制，通常为1毫秒或10毫秒，定时器终端时，内核可以进行进程调度</li>
</ul>
<h3 id="一个因为读取磁盘的调度实例">一个因为读取磁盘的调度实例</h3>
<p><img src="https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/20190517154055218_966731524.png" alt=""></p>
<ol>
<li>初始时，进程A运行在用户模式，进程调用read命令时，进程A会从用户态切换到内核态，同时内核会把A的内核态切换到B的内核态进程，然后再运行在B的用户态执行</li>
<li>同时陷阱处理程序会通过DMA，不经过cpu，直接将数据从磁盘读取到内存中，读取完毕后，磁盘控制器会向cpu发送一个中断信息</li>
<li>当内核觉得进程B已经执行了足够长的时间时，内核通过切换上下文，将控制权移交给A进程，同时从read的之后的指令开始执行</li>
</ol>
<h2 id="进程的三种状态">进程的三种状态</h2>
<ol>
<li>运行 正在cpu执行，或者在等待被执行且最终会被执行</li>
<li>停止 进程执行被挂起，且不会被调度。</li>
<li>终止 进程永远的停止了 三种终止原因：1.收到一个信号 2.从主程序返回 3.exit函数退出</li>
</ol>
<h2 id="创建子进程">创建子进程</h2>
<ul>
<li>父进程创建子进程时，会拥有和父进程相同的代码段，数据段和用户栈以及文件描述符表</li>
<li>父进程和子进程最大的区别就是PID是不同的</li>
</ul>
<h2 id="回收子进程">回收子进程</h2>
<ul>
<li>当一个子进程由于某种原因终止时，内核并不会把它立即从系统中清除，而是保持在终止状态下，指到父进程回收</li>
<li>一个已经终止了，但是还未被回收的进程成为僵尸进程</li>
<li>当父进程终止了，内核会安排init进程作为他的孤儿子进程的养父，init进程的PID为1
<ul>
<li>一号进程是在系统启动时创建的</li>
</ul>
</li>
</ul>
<h2 id="信号">信号</h2>
<ul>
<li>传送信号到目的进程，分为两个步骤
<ol>
<li>发送信号 内核通过更新目的进程上下文的某个状态，发送一个信号给目的进程</li>
</ol>
<ul>
<li>发送信号的原因有两种： 1.内核检测到一个系统事件，比如除零操作或者子进程终止 2.一个进程调用了kill函数，	显示的要求信号给一个目的进程</li>
</ul>
<ol start="2">
<li>当目的进程被内核强制对信号的发送做出反应时，同时进程可以忽略这个信号，终止或者执行一个信号处理程序来捕获信号
<img src="https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/20190517154117101_2142934313.png" alt=""></li>
</ol>
</li>
</ul>
<h2 id="待处理信号">待处理信号</h2>
<ul>
<li>一个发出但是未被处理的信号被是待处理信号，任何时刻，一种信号最多有一个待处理信号，其他的信号会被简单的丢弃</li>
<li>同时进程可以阻塞某种信号，仍可以发送，但是不会被接收（处理）</li>
</ul>
<h2 id="发送信号">发送信号</h2>
<p>Unix提供了大量向进程发送信号的机制，这些机制是基于进程组的</p>
<h3 id="进程组">进程组</h3>
<p>每个进程都属于一个进程组，默认的子进程的进程组PGID是父进程的PID</p>
<ul>
<li>shell
<ul>
<li>对于shell来说，最多有一个前台任务和多个后台任务，shell会为每个作业创建一个独立的进程组</li>
</ul>
</li>
</ul>
<h2 id="信号的收发">信号的收发</h2>
<p><img src="https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/20190517154140699_848754754.png" alt=""></p>
<ul>
<li>进程A发送信号给进程B，信号会被传递给内核，内核会对信号进行权限等处理，内核首先判断进程A是否允许对进程B发送该信号，如果可以的话，内核将对B进程的进程表进行设置，如果该信号已经被设置过之后，且还没有进行响应，则该信号则会被丢弃</li>
<li>进程B收到信号后，一般不会立即处理，而是会在中断返回之后或者从内核态返回用户态时对信号进行处理</li>
</ul>
<h2 id="接收信号">接收信号</h2>
<p><img src="https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/20190517154210200_1434767104.png" alt=""></p>
<ul>
<li>一个信号处理程序可以被其他信号处理程序中断</li>
</ul>

    </div>
</section>

</body>
<br>
    <div class="wrap">
        <script type="text/javascript">
            
            var pic = [];
            pic[0] = "https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/m731jF20220117115554.png";
            pic[1] = "https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/m731jF20220117115554.png";
            pic[2] = "https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/m731jF20220117115554.png";
            pic[3] = "https://cdn.jsdelivr.net/gh/nber1994/fu0k@master/uPic/m731jF20220117115554.png";

            var talk = [];
            talk[0] = "mail : jingherego@gmail.com";
            talk[1] = "github : github.com/nber1994";
            talk[2] = "本站内容部分来源于网络，可转载.";
            talk[3] = "如有错误，请联系我";

            var randomBgIndex = Math.floor( Math.random() * 4 );

            
            
            document.write("<img src=" + pic[randomBgIndex] + " width='400'>")
            document.write("<span style='font-size:12px;'><p>" + talk[randomBgIndex] + " </p></span>")
            
        </script>
    </div>


</html>
